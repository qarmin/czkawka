import { Button, CheckBox, ComboBox, LineEdit, ScrollView, Slider } from "std-widgets.slint";
import { ActiveTab } from "common.slint";
import { Settings } from "settings.slint";
import { GuiState } from "gui_state.slint";
import { TextComponent } from "settings_list.slint";
import { Translations } from "translations.slint";
import { ColorPalette } from "color_palette.slint";
import { FontSizes } from "fonts.slint";

component ComboBoxWrapper inherits HorizontalLayout {
    in-out property <string> text;
    in-out property <[string]> model;
    in-out property <int> current_index;
    in-out property <string> current_value;
    spacing: 5px;
    Text {
        text <=> root.text;
        vertical_alignment: TextVerticalAlignment.center;
        font-size: FontSizes.normal;
    }

    ComboBox {
        model: root.model;
        current_index <=> root.current_index;
        current_value <=> root.current_value;
    }
}

component CheckBoxWrapper inherits CheckBox { }

component SubsettingsHeader inherits Text {
    text: Translations.subsettings_text;
    font-size: FontSizes.normal;
    height: 30px;
}

// Reusable text wrapper to centralize font-size and height
component LabelText inherits Text {
    in-out property <string> label_text;
    in-out property <length> label_font_size: FontSizes.normal;
    in-out property <length> label_height: 25px;
    text: root.label_text;
    font-size: root.label_font_size;
    height: root.label_height;
    vertical-alignment: TextVerticalAlignment.center;
}

component SliderWrapper inherits HorizontalLayout {
    in-out property <float> maximum;
    in-out property <float> minimum: 0;
    in-out property <float> value;
    in-out property <string> text;
    in-out property <string> end_text;
    in-out property <length> end_text_size;
    spacing: 5px;
    Text {
        text: root.text;
        font-size: FontSizes.normal;
    }

    Slider {
        min-width: 30px;
        minimum <=> root.minimum;
        maximum <=> root.maximum;
        value <=> root.value;
    }

    Text {
        text: root.end_text;
        width: root.end_text_size;
        font-size: FontSizes.normal;
    }
}

component HintText inherits Text {
    in-out property <string> hint_text;
    font-size: FontSizes.small;
    color: ColorPalette.hint_color;
    text: root.hint_text;
    wrap: TextWrap.word-wrap;
}

export component ToolSettings {
    ScrollView {
        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.SimilarImages;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            ComboBoxWrapper {
                text: Translations.subsettings_images_hash_size_text;
                model: Settings.similar_images_sub_available_hash_size;
                current_index <=> Settings.similar_images_sub_hash_size_index;
                current_value <=> Settings.similar_images_sub_hash_size_value;
            }

            ComboBoxWrapper {
                text: Translations.subsettings_images_resize_algorithm_text;
                model: Settings.similar_images_sub_available_resize_algorithm;
                current_index <=> Settings.similar_images_sub_resize_algorithm_index;
                current_value <=> Settings.similar_images_sub_resize_algorithm_value;
            }

            ComboBoxWrapper {
                text: Translations.subsettings_images_duplicates_hash_type_text;
                model: Settings.similar_images_sub_available_hash_type;
                current_index <=> Settings.similar_images_sub_hash_alg_index;
                current_value <=> Settings.similar_images_sub_hash_alg_value;
            }

            Rectangle {
                height: 0px;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_images_ignore_same_size_text;
                checked <=> Settings.similar_images_sub_ignore_same_size;
            }

            Rectangle {
                height: 4px;
            }

            SliderWrapper {
                text: Translations.subsettings_images_max_difference_text;
                end_text: "(" + round(Settings.similar_images_sub_current_similarity) + "/" + round(Settings.similar_images_sub_max_similarity) + ")";
                end_text_size: 40px;
                maximum <=> Settings.similar_images_sub_max_similarity;
                value <=> Settings.similar_images_sub_current_similarity;
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.DuplicateFiles;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            ComboBoxWrapper {
                text: Translations.subsettings_duplicates_check_method_text;
                model: Settings.duplicates_sub_check_method;
                current_index <=> Settings.duplicates_sub_check_method_index;
                current_value <=> Settings.duplicates_sub_check_method_value;
            }

            ComboBoxWrapper {
                text: Translations.subsettings_images_duplicates_hash_type_text;
                model: Settings.duplicates_sub_available_hash_type;
                current_index <=> Settings.duplicates_sub_available_hash_type_index;
                current_value <=> Settings.duplicates_sub_available_hash_type_value;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_duplicates_name_case_sensitive_text;
                checked <=> Settings.duplicates_sub_name_case_sensitive;
                height: 25px;
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.BigFiles;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            ComboBoxWrapper {
                text: Translations.subsettings_biggest_files_sub_method_text;
                model: Settings.biggest_files_sub_method;
                current_index <=> Settings.biggest_files_sub_method_index;
                current_value <=> Settings.biggest_files_sub_method_value;
            }

            TextComponent {
                name: Translations.subsettings_biggest_files_sub_number_of_files_text;
                model <=> Settings.biggest_files_sub_number_of_files;
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.SimilarVideos;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }
            CheckBoxWrapper {
                text: Translations.subsettings_videos_ignore_same_size_text;
                checked <=> Settings.similar_videos_sub_ignore_same_size;
            }

            Rectangle {
                height: 0px;
            }

            ComboBoxWrapper {
                text: Translations.subsettings_videos_crop_detect_text;
                model: Settings.similar_videos_crop_detect;
                current_index <=> Settings.similar_videos_crop_detect_index;
                current_value <=> Settings.similar_videos_crop_detect_value;
            }

            Rectangle {
                height: 0px;
            }

            SliderWrapper {
                text: Translations.subsettings_videos_max_difference_text;
                end_text: "(" + round(Settings.similar_videos_sub_current_similarity) + "/" + round(Settings.similar_videos_sub_max_similarity) + ")";
                end_text_size: 40px;
                maximum <=> Settings.similar_videos_sub_max_similarity;
                value <=> Settings.similar_videos_sub_current_similarity;
            }

            SliderWrapper {
                text: Translations.subsettings_videos_skip_forward_amount_text;
                end_text: "(" + round(Settings.similar_videos_skip_forward_amount) + "/" + round(Settings.similar_videos_skip_forward_amount_max) + ")";
                end_text_size: 55px;
                maximum <=> Settings.similar_videos_skip_forward_amount_max;
                minimum <=> Settings.similar_videos_skip_forward_amount_min;
                value <=> Settings.similar_videos_skip_forward_amount;
            }

            SliderWrapper {
                text: Translations.subsettings_videos_vid_hash_duration_text;
                end_text: "(" + round(Settings.similar_videos_vid_hash_duration) + "/" + round(Settings.similar_videos_vid_hash_duration_max) + ")";
                end_text_size: 40px;
                maximum <=> Settings.similar_videos_vid_hash_duration_max;
                minimum <=> Settings.similar_videos_vid_hash_duration_min;
                value <=> Settings.similar_videos_vid_hash_duration;
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.SimilarMusic;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            ComboBoxWrapper {
                text: Translations.subsettings_music_audio_check_type_text;
                model: Settings.similar_music_sub_audio_check_type;
                current_index <=> Settings.similar_music_sub_audio_check_type_index;
                current_value <=> Settings.similar_music_sub_audio_check_type_value;
            }
            if Settings.similar_music_sub_audio_check_type_index == 0: VerticalLayout {
                spacing: 5px;
                CheckBoxWrapper {
                    text: Translations.subsettings_music_approximate_comparison_text;
                    checked <=> Settings.similar_music_sub_approximate_comparison;
                    height: 40px;
                }

                LabelText { label_text: Translations.subsettings_music_compared_tags_text + ":"; label_height: 20px; }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_title_text;
                    checked <=> Settings.similar_music_sub_title;
                }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_artist_text;
                    checked <=> Settings.similar_music_sub_artist;
                }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_bitrate_text;
                    checked <=> Settings.similar_music_sub_bitrate;
                }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_genre_text;
                    checked <=> Settings.similar_music_sub_genre;
                }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_year_text;
                    checked <=> Settings.similar_music_sub_year;
                }

                CheckBoxWrapper {
                    text: Translations.subsettings_music_length_text;
                    checked <=> Settings.similar_music_sub_length;
                }

                Rectangle {}
            }
            if Settings.similar_music_sub_audio_check_type_index == 1: VerticalLayout {
                spacing: 5px;

                CheckBoxWrapper {
                    text: Translations.subsettings_music_compare_fingerprints_only_with_similar_titles_text;
                    checked <=> Settings.similar_music_compare_fingerprints_only_with_similar_titles;
                    height: 40px;
                }
                SliderWrapper {
                    text: Translations.subsettings_music_max_difference_text;
                    end_text: "(" + round(Settings.similar_music_sub_maximum_difference_value) + "/" + round(Settings.similar_music_sub_maximum_difference_max) + ")";
                    end_text_size: 40px;
                    maximum <=> Settings.similar_music_sub_maximum_difference_max;
                    value <=> Settings.similar_music_sub_maximum_difference_value;
                }

                SliderWrapper {
                    text: Translations.subsettings_music_minimal_fragment_duration_text;
                    end_text: round(Settings.similar_music_sub_minimal_fragment_duration_value);
                    end_text_size: 40px;
                    maximum <=> Settings.similar_music_sub_minimal_fragment_duration_max;
                    value <=> Settings.similar_music_sub_minimal_fragment_duration_value;
                }
            }
            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.BrokenFiles;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            LabelText { label_text: Translations.subsettings_broken_files_type_text; }

            CheckBoxWrapper {
                text: Translations.subsettings_broken_files_audio_text;
                checked <=> Settings.broken_files_sub_audio;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_broken_files_pdf_text;
                checked <=> Settings.broken_files_sub_pdf;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_broken_files_archive_text;
                checked <=> Settings.broken_files_sub_archive;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_broken_files_image_text;
                checked <=> Settings.broken_files_sub_image;
            }

            CheckBoxWrapper {
                text: Translations.subsettings_broken_files_video_text;
                checked <=> Settings.broken_files_sub_video;
            }

            HintText {
                hint_text: Translations.subsettings_broken_files_video_info_text;
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.VideoOptimizer;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            ComboBoxWrapper {
                text: Translations.subsettings_video_optimizer_mode_text;
                model: Settings.video_optimizer_sub_mode;
                current_index <=> Settings.video_optimizer_sub_mode_index;
                current_value <=> Settings.video_optimizer_sub_mode_value;
            }

            if Settings.video_optimizer_sub_mode_index == 1: VerticalLayout {
                spacing: 5px;

                HorizontalLayout {
                    spacing: 5px;
                    Text {
                        text: Translations.subsettings_video_optimizer_excluded_codecs_text;
                        vertical_alignment: TextVerticalAlignment.center;
                        font-size: FontSizes.normal;
                    }

                    LineEdit {
                        text <=> Settings.video_optimizer_sub_excluded_codecs;
                        font-size: FontSizes.normal;
                    }

                    Button {
                        text: Translations.subsettings_reset_text;
                        clicked => {
                            Settings.video_optimizer_sub_excluded_codecs = "h265,av1,vp9";
                        }
                    }
                }
            }

            if Settings.video_optimizer_sub_mode_index == 0: VerticalLayout {
                spacing: 5px;

                ComboBoxWrapper {
                    text: Translations.subsettings_video_optimizer_crop_type_text;
                    model: Settings.video_optimizer_sub_crop_type;
                    current_index <=> Settings.video_optimizer_sub_crop_type_index;
                    current_value <=> Settings.video_optimizer_sub_crop_type_value;
                }

                HorizontalLayout {
                    spacing: 5px;
                    Text {
                        text: Translations.subsettings_video_optimizer_black_pixel_threshold_text;
                        vertical_alignment: TextVerticalAlignment.center;
                        font-size: FontSizes.normal;
                    }

                    LineEdit {
                        text <=> Settings.video_optimizer_sub_black_pixel_threshold;
                        font-size: FontSizes.normal;
                    }

                    Button {
                        text: Translations.subsettings_reset_text;
                        clicked => {
                            Settings.video_optimizer_sub_black_pixel_threshold = "20";
                        }
                    }
                }

                HintText {
                    hint_text: Translations.subsettings_video_optimizer_black_pixel_threshold_hint_text;
                }

                HorizontalLayout {
                    spacing: 5px;
                    Text {
                        text: Translations.subsettings_video_optimizer_black_bar_min_percentage_text;
                        vertical_alignment: TextVerticalAlignment.center;
                        font-size: FontSizes.normal;
                    }

                    LineEdit {
                        text <=> Settings.video_optimizer_sub_black_bar_min_percentage;
                        font-size: FontSizes.normal;
                    }

                Button {
                    text: Translations.subsettings_reset_text;
                    clicked => {
                        Settings.video_optimizer_sub_black_bar_min_percentage = "90";
                    }
                }
                }

                HintText {
                    hint_text: Translations.subsettings_video_optimizer_black_bar_min_percentage_hint_text;
                }

                HorizontalLayout {
                    spacing: 5px;
                    Text {
                        text: Translations.subsettings_video_optimizer_max_samples_text;
                        vertical_alignment: TextVerticalAlignment.center;
                        font-size: FontSizes.normal;
                    }

                    LineEdit {
                        text <=> Settings.video_optimizer_sub_max_samples;
                        font-size: FontSizes.normal;
                    }

                    Button {
                        text: Translations.subsettings_reset_text;
                        clicked => {
                            Settings.video_optimizer_sub_max_samples = "60";
                        }
                    }
                }

                HintText {
                    hint_text: Translations.subsettings_video_optimizer_max_samples_hint_text;
                }

                HorizontalLayout {
                    spacing: 5px;
                    Text {
                        text: Translations.subsettings_video_optimizer_min_crop_size_text;
                        vertical_alignment: TextVerticalAlignment.center;
                        font-size: FontSizes.normal;
                    }

                    LineEdit {
                        text <=> Settings.video_optimizer_sub_min_crop_size;
                        font-size: FontSizes.normal;
                    }

                    Button {
                        text: Translations.subsettings_reset_text;
                        clicked => {
                            Settings.video_optimizer_sub_min_crop_size = "5";
                        }
                    }
                }

                HintText {
                    hint_text: Translations.subsettings_video_optimizer_min_crop_size_hint_text;
                }
            }

            Rectangle { }
        }

        VerticalLayout {
            visible: GuiState.active_tab == ActiveTab.ExifRemover;
            spacing: 5px;
            padding: 10px;
            SubsettingsHeader { }

            HorizontalLayout {
                spacing: 5px;
                Text {
                    text: Translations.subsettings_exif_ignored_tags_text;
                    vertical_alignment: TextVerticalAlignment.center;
                    font-size: FontSizes.normal;
                }

                LineEdit {
                    text <=> Settings.ignored_exif_tags;
                    font-size: FontSizes.normal;
                }
            }

            HintText {
                hint_text: Translations.subsettings_exif_ignored_tags_hint_text;
            }

            Rectangle { }
        }
    }
}
