# Krokiet

Krokiet is the new Czkawka frontend written in Slint, which uses Rust in opposite to the GTK 4 frontend,
which uses mostly C code.

![Krokiet](https://github.com/qarmin/czkawka/assets/41945903/52628a29-ecd6-4692-9ee4-8a680c889193)

Different toolkit means different looks, limitations, and features, so you shouldn't expect the same features of the GTK 4
frontend (but of course, I want to implement most features from the other project).

## Usage

Krokiet shouldn't have any special runtime requirements—it should work on almost any non-antic device.

Prebuilt binaries should work on Windows 10,11, Mac, Ubuntu 22.04/20.04 and similar(libheif version and czkawka_gui
requires Ubuntu 22.04+, rest Ubuntu 20.04) - https://github.com/qarmin/czkawka/releases/

## Compilation

On Ubuntu you need to install these dependencies:

```
sudo apt install libfontconfig-dev libfreetype-dev
```

Default compilation is done by `cargo build --release` and should work on most systems.

Currently, rustc has problems in optimizing code generated by Slint (~90.000 lines of code with version 7.0.0),
so the default release build usually takes > 60 minutes.  
As workaround, you can use this command, which requires a nightly version of Rust:

```
RUSTFLAGS="-Zmir-enable-passes=-ScalarReplacementOfAggregates" cargo +nightly build --release
```

The only exception is building skia renderer, which is a non-default feature that can be enabled manually
if you want to use it, that requires on Windows the msvc compiler (unsure how to exactly install it).

Also, skia renderer is written in C++ and used on platforms like x86_64 and arm64 prebuilt binaries, so if you're using
a different architecture, this library will be built from source, which can take a lot of time and require additional
dependencies.

## Additional renderers

By default, only femtovg (OpenGL) and software renderer are enabled, but you can enable more renderers by compiling
the app with additional features.

Most users will want to use the app with a windowing system/compositor, so features starting with `winit` in name are
recommended.

E.g.:

```
cargo build --release --features "winit_skia_opengl"
cargo build --release --features "winit_software"
```

to run the app with different renderers, you need to use it by adding the `SLINT_BACKEND` environment variable

```
SLINT_BACKEND=winit-femtovg ./target/release/krokiet
SLINT_BACKEND=software ./target/release/krokiet
SLINT_BACKEND=skia ./target/release/krokiet # This now uses OpenGL - https://github.com/slint-ui/slint/discussions/3799
```

when you use an invalid/non-existing backend, the app will show the warning:

```
slint winit: unrecognized renderer skia, falling back to FemtoVG
```

To check what is really used, add `SLINT_DEBUG_PERFORMANCE=refresh_lazy,console,overlay` environment variable:

```
SLINT_DEBUG_PERFORMANCE=refresh_lazy,console,overlay cargo run
```

It should print something like:

```
Slint: Build config: debug; Backend: software
```

## Different theme

The app was created with dark fluent theme in mind, but it is possible to use light theme by setting `SLINT_STYLE`
environment variable to `fluent-light` during compilation, e.g.:

```
SLINT_STYLE=fluent-light cargo run -- --path .
```

Slint supports other themes too, but they aren't officially supported by this app and may be broken (but Cupertino
looks quite good with the current style).

```
SLINT_STYLE=cupertino-light cargo run -- --path .
SLINT_STYLE=cupertino-dark cargo run -- --path .
SLINT_STYLE=material-light cargo run -- --path .
SLINT_STYLE=material-dark cargo run -- --path .
```

## How to help?

- Suggesting possible design changes in the GUI - of course, they should be possible to be simply implemented in the
  Slint keeping in mind the performance aspect as well
- Modifying user interface - gui is written in simple language similar to qml, that can be modified in vscode/web with
  live
  preview - [slint live preview example](https://slint.dev/releases/1.3.0/editor/?load_demo=examples/printerdemo/ui/printerdemo.slint)
- Improving app rust code

## Why Slint?

There are multiple reasons why I decided to use Slint as toolkit for Krokiet over other toolkits.

| Toolkit | Pros                                                                                                                                                                                                                                                         | Cons                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GTK 4   | - Good Linux support </br> - Cambalache can be used to create graphically GUI </br> - Good gtk4-rs bindings (but sometimes not really intuitive)                                                                                                             | - Hard compilation/cross-compilation and bundling all required libraries - Mostly on Windows </br> - Forcing to use a specific GUI creation style </br> - Strange crashes, broken basic features, etc. (again, mostly on Windows) </br> - Forcing to use buggy/outdated but dynamically loaded version of libraries on Linux (e.g., 4.6 on Ubuntu 22.04) - Not all fixes are backported                                                                                                                         |
| Qt      | - QML support - Simplified GUI creation from code, easy to use, and powerful </br> - Very flexible framework <br/> - TypeScript/JavaScript <=> QML interoperability </br> - Probably the most mature GUI library                                             | - New and limited qt bindings <br/> - Hard to cross-compile <br/>  - Very easy to create and use invalid state in QML (unexpected null/undefined values, messed properties bindings, etc.) <br/> - Commercial license or GPL                                                                                                                                                                                                                                                                                    |
| Slint   | - Internal language is compiled to native code <br/> - Live GUI preview with VS Code/VSCodium without needing to use Rust <br/> - Full Rust solution - Easy to compile/cross-compile, minimal runtime requirements </br> - Static type checks in Slint files | - Internal .slint language is more limited than QML <br/> - Out of bounds and similar errors are quietly being corrected instead of printing error - This can lead to hard-to-debug problems <br/> - Only GPL is available as open-source license <br/> - Popup windows almost don't exist <br/> - Internal widgets are almost non-customizable and usually quite limited </br> - Creating big/good-looking with custom widgets GUI is very hard                                                                |
| Iced    | - ~100% Rust code - So compilation is simple </br> - Elm architecture - Simple to understand                                                                                                                                                                 | - Mostly maintained by one person - Slows down fixing bugs and implementing new features </br> - GUI can be created from Rust code only, which is really bad for creating complex GUIs (mostly due to Rust compile times)  </br> - Docs are almost non-existent                                                                                                                                                                                                                                                 |
| Tauri   | - Easy to create UI (at least for web developers) - uses HTML/CSS/JS</br>- Quite portable                                                                                                                                                                    | - WebView dependency - it is heavy and can be hard to compile on some platforms and on Linux, e.g., webRTC not working</br>- Can't select directory - File chooser can only choose files - Small but important thing for me</br>- Not very performant Rust <=> JavaScript communication (less problematic with [Tauri 2](https://github.com/tauri-apps/tauri/pull/7170#issuecomment-1583279023)) </br> - Uses JavaScript/TypeScript, which is much harder to update/maintain than Rust due to being less strict |

Since I don't have time to create really complex and good-looking GUI, I needed a helper tool to create GUI not from
Rust (I don't want to use a different language because this will make communication with czkawka_core harder),
so I decided to not look at Iced, which only allows to create GUI from Rust.

I throw away GTK and Qt too due to cross-compilation problems caused mostly by using C/C++ internally. Using GTK in
Czkawka was a reason why I started to find other toolkits.

Tauri - I don't really like to use JavaScript. I already used it with Qt (C++) + QML + TypeScript combination, and
I found that creating a UI in such a language may be simple at start, but later any bigger changes cause a lot of runtime
errors. Despite these problems, my next project (closed-source) will just use Tauri + Slint, because actually in that
case, it is rather the best option.

So only Slint left with its cons and pros.

## License

Code is licensed under MIT license, but the entire project is licensed under GPL-3.0 license due to Slint license restrictions.

## Name

Why Krokiet (eng. Croquette)?  
Because I like croquettes (Polish version), the ones with meat, mushrooms wrapped in breadcrumbs… it makes my mouth
water.  
I considered also other dishes which I like to eat like pierogi, żurek, pączek, schabowy or zapiekanka.  
This name should be much easier to remember than czkawka or szyszka.